<html>
<body style="margin: 0px">

<canvas id="canvas">

</canvas>

<script>
    function Cube(x, z) {
        this.verts = [
            [x-1, 1, z-1],
            [x+1, 1, z-1],
            [x+1,-1, z-1],
            [x-1,-1, z-1],
            [x-1, 1, z+1],
            [x+1, 1, z+1],
            [x+1,-1, z+1],
            [x-1,-1, z+1]
        ];

        this.edges = [
            [0, 1],
            [0, 3],
            [0, 4],
            [1, 2],
            [1, 5],
            [2, 3],
            [2, 6],
            [3, 7],
            [4, 5],
            [4, 7],
            [5, 6],
            [6, 7]
        ];
    };

    Cube.prototype.show = function(context, cam) {
        let xOff = canvas.width / 2;
        let yOff = canvas.height / 2;

        context.strokeStyle = '#BBBBFF';

    	points = this.verts.map(vert => {
            let x, y, z;
            [x, y, z] = vert.map(v => v);
            x -= cam.x;
            y -= cam.y;
            z -= cam.z;
            [x, z] = rotate(x, z, cam.rotx)
            if (z <= 0)
                return null
            let f = 100 / z;
            x *= f;
            y *= f;
            return [x + xOff, y + yOff]
        });

        this.edges.forEach(edge => {
            context.beginPath();
            let p1 = points[edge[0]];
            let p2 = points[edge[1]];
            if (p1 == null || p2 == null)
                return
            let x1, y1, x2, y2;
            [x1, y1] = p1;
            [x2, y2] = p2;
            context.moveTo(x1, y1);
            context.lineTo(x2, y2);
            context.stroke();
        });
    };

    var canvas = document.getElementById('canvas');
    var context = canvas.getContext('2d');
    var cam = {x: 0, y: 0, z: -5, rotx: 0, roty: 0};
    var keys = {}
    var cubes = [new Cube(0, 0), new Cube(0, 2), new Cube(0, 4)];

    document.body.onkeydown = (event) => {
        keys[event.key] = true;
    };

    document.body.onkeyup = (event) => {
        keys[event.key] = false;
    };

    function rotate(x, y, rad) {
        s = Math.sin(rad);
        c = Math.cos(rad);
        return [x*c-y*s, y*c+x*s]
    }

    function render() {
    	requestAnimationFrame(render);

        if (keys['w']) {
            cam.z += 0.1;
        }
        if (keys['s']) {
            cam.z -= 0.1;
        }
        if (keys['d']) {
            let x, z;
            [x, z] = rotate(0.1, 0, cam.rotx);
            console.log(x, z);
            cam.x += x;
            cam.z += z
        }
        if (keys['a']) {
            let x, z;
            [x, z] = rotate(0.1, 0, cam.rotx);
            console.log(x, z);
            cam.x -= x;
            cam.z -= z
        }
        if (keys['q']) {
            cam.rotx += 0.01;
        }
        if (keys['e']) {
            cam.rotx -= 0.01;
        }

    	context.fillStyle = '#333344';
    	context.fillRect(0, 0, canvas.width, canvas.height);

        cubes.forEach(cube => {
            cube.show(context, cam);
        });
    };

    render();

    document.body.onresize = () => {
    	canvas.width = window.innerWidth;
    	canvas.height = window.innerHeight;
    };

    window.onload = () => {
    	canvas.width = window.innerWidth;
    	canvas.height = window.innerHeight;
    }
</script>

</body>
</html
